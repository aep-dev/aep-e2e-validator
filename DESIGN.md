# Design

## Goals

aep-e2e-validator covers the gap of validation of runtime functionality defined in [aep.dev](https://aep.dev).

## Design Details

### Code

The code is written Go, leveraging the shared functionality in the [aep-lib-go repository](https://github.com/aep-dev/aep-lib-go/).

The code is organized under individual rules, which can be referenced by the AEP that they are validating, along with the semantic behavior (e.g. `aep-133-e2e-create`).

### Interface

The tester will be available as a binary, and will be invoked as follows:

```bash
aep-e2e-validator validate --config <path-to-openapi-spec> --collection <collection-name>
```

All collections can be validated using the `--all-collections` flag:

```bash
aep-e2e-validator validate --config <path-to-openapi-spec> --all-collections
```

### Testing Approach

The validator, by necessity, must operate on the resources that are exposed by
an API. Therefore, the validator should be run against a staging or testing API.

The test suite runs in a single pass, due to the prerequisites for the state of
the backing data (e.g. to delete a resource, a resource must already exist). If
a specific test fails and success is a prerequisite for the next test, execution
will stop there.

### Testing on a collection

The e2e test can be run on a per-collection basis. The API payload is
generated by examining the openapi schema of the resource, and constructing a payload that only contains the required values.

### Test Sequence

As time goes one, the tests in this repository will grow. But the initial set of proposed test are:

1. Create a resource.
1. Attempt to create the first resource, and observe the correct error code.
1. Create a second resource.
1. List all resources with a limit of 1
    1. the first resource should exist in the list.
1. List all resources a second time, using the page token from the previous request.
    1. the second resource should exist in the list.
1. Update the first resource.
1. Get the first resource, to validate the update.
1. Delete the first resource.
1. Attempt to delete the first resource a second time. Observe a 404 error.
1. Get the deleted resource. Observe the 404 error.
1. Delete the second resource.
1. List the collection to ensure that no resources remain.